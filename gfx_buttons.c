#include <SDL.h>

#include "render.h"
#include "gfx_charmap.h"

int b_colors[3][3] = {
    { 255,255,255 },
    { 0,128,0 },
    { 0,0,0 }
};

int buttons[2][2][10][64] = {
    {
        {
            { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
            { 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,3,3,3,3,3,2,2,3,3,2,2,3,2,2,2,3,2,3,3,3,3,2,3,3,3,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,2,2,3,2,3,2,2,2,2,3,2,2,3,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,2,2,3,2,3,3,3,2,2,3,3,3,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,3,2,3,2,3,2,2,2,2,3,3,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,3,2,3,2,3,2,2,2,2,3,2,3,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,2,3,3,2,2,2,3,2,3,2,2,3,3,3,3,2,3,2,2,3,2,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 }
        },
        {
            { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
            { 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,3,3,3,3,3,2,2,3,3,2,2,3,2,2,2,3,2,3,3,3,3,2,3,3,3,2,2,2,2,2,2,3,2,2,2,2,2,2,3,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,2,2,3,2,3,2,2,2,2,3,2,2,3,2,2,2,2,2,3,2,2,2,2,2,2,2,3,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,2,2,3,2,3,3,3,2,2,3,3,3,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,3,2,3,2,3,2,2,2,2,3,3,2,2,2,2,2,2,2,3,2,2,2,2,2,2,2,2,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,3,2,3,2,3,2,2,2,2,3,2,3,2,2,2,2,2,2,3,2,2,2,2,2,2,2,3,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,2,3,3,2,2,2,3,2,3,2,2,3,3,3,3,2,3,2,2,3,2,2,2,2,2,3,2,2,2,2,2,2,3,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 }
        }
    },
    {
        {
            { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
            { 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,3,3,3,3,3,2,2,3,3,2,2,3,2,2,2,3,2,3,3,3,3,2,3,3,3,2,2,2,2,2,2,3,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,2,2,3,2,3,2,2,2,2,3,2,2,3,2,2,2,2,2,3,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,2,2,3,2,3,3,3,2,2,3,3,3,2,2,2,2,2,2,3,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,3,2,3,2,3,2,2,2,2,3,3,2,2,2,2,2,2,2,3,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,3,2,3,2,3,2,2,2,2,3,2,3,2,2,2,2,2,2,3,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,2,3,3,2,2,2,3,2,3,2,2,3,3,3,3,2,3,2,2,3,2,2,2,2,2,3,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 }
        },
        {
            { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
            { 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,3,3,3,3,3,2,2,3,3,2,2,3,2,2,2,3,2,3,3,3,3,2,3,3,3,2,2,2,2,2,2,3,2,3,2,2,2,2,3,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,2,2,3,2,3,2,2,2,2,3,2,2,3,2,2,2,2,2,3,2,3,2,2,2,2,2,3,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,2,2,3,2,3,3,3,2,2,3,3,3,2,2,2,2,2,2,3,2,3,2,2,2,2,2,2,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,3,2,3,2,3,2,2,2,2,3,3,2,2,2,2,2,2,2,3,2,3,2,2,2,2,2,2,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,3,2,2,3,2,3,2,3,2,3,2,3,2,2,2,2,3,2,3,2,2,2,2,2,2,3,2,3,2,2,2,2,2,3,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,3,2,2,2,2,3,3,2,2,2,3,2,3,2,2,3,3,3,3,2,3,2,2,3,2,2,2,2,2,3,2,3,2,2,2,2,3,2,2,2,2,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1 },
            { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 }
        }
    }

};

SDL_Surface *buttonsurface;
SDL_Rect button_rects[2] = {
    { 260, 430, 64, 10 },
    { 260, 445, 64, 10 }
};

int button_count = 2;
int button_pressed[2] = { 1, 0 };
char buttonhint[2][40] = {
    "build archer tower",
    "build cannon tower"
};

void init_buttons(void) {
    int b,d,x,y;
    SDL_Rect pixel = { 0,0,1,1 };
    buttonsurface = SDL_CreateRGBSurface(SDL_HWSURFACE, 64*2, 20, 32, RMASK, GMASK, BMASK, AMASK);

    for ( b=0;b<2;b++ ) {
        for ( d=0;d<2;d++ ) {
            for ( y=0;y<10;y++ ) {
                for ( x=0;x<64;x++ ) {
                    pixel.x = x+(d*64);
                    pixel.y = y+(b*10);
                    SDL_FillRect(buttonsurface, &pixel, SDL_MapRGB(buttonsurface->format,
                        b_colors[buttons[b][d][y][x]-1][0],
                        b_colors[buttons[b][d][y][x]-1][1],
                        b_colors[buttons[b][d][y][x]-1][2])
                    );
                }
            }
        }
    }
}

void draw_buttons(SDL_Surface *s) {
    int i,ax,ay;
    SDL_Rect rect = { 0,0,64,10 };
    for (i=0;i<button_count;i++) {
        if ( button_pressed[i] == 1 ) rect.x = 64;
        else rect.x = 0;

        rect.y = i*10;
        for (ay=(button_rects[i].y/RECTSIZE_Y);ay<((button_rects[i].y+button_rects[i].w+1)/RECTSIZE_Y);ay++) {
            for (ax=(button_rects[i].x/RECTSIZE_Y);ax<((button_rects[i].x+button_rects[i].x+1)/RECTSIZE_X);ax++) {
                updaterect(ax,ay);
            }
        }
        SDL_BlitSurface(buttonsurface, &rect, s, &button_rects[i]);
    }
}

void press_button(int x, int y) {
    int i, n;
    for (i=0;i<button_count;i++) {
        if ( x < (button_rects[i].x + button_rects[i].w) && x > button_rects[i].x && y > button_rects[i].y && y < (button_rects[i].y + button_rects[i].h) ) {
            button_pressed[i] = 1;
            for (n=0;n<button_count;n++) { if (n != i ) button_pressed[n] = 0; }
            draw_buttons(get_screen());
        }
    }
}

void draw_hint_text(SDL_Surface *s) {
    int i;
    for (i=0;i<button_count;i++) {
        if ( button_pressed[i] == 1 ) draw_text(s, buttonhint[i], 320, 416);
    }
}
